---
title: "Data visualization with ggplot2"
author: "John Blischak"
date: "2019-09-25"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

* [Book chapter](https://r4ds.had.co.nz/data-visualisation.html)
* [Source](https://github.com/hadley/r4ds/blob/master/visualize.Rmd)

## Setup

```{r}
library(ggplot2)
data(mpg)
head(mpg)
```

## First steps

p. 6

> Run `ggplot(data = mpg)`. What do you see?

A blank plot

```{r}
ggplot(data = mpg)
```

> How many rows are in `mpg`? How many columns?

```{r}
nrow(mpg)
ncol(mpg)
```

>  What does the `drv` variable describe?  Read the help for `?mpg` to find
>  out.

```{r}
?mpg
```

drv: f = front-wheel drive, r = rear wheel drive, 4 = 4wd

> Make a scatterplot of `hwy` vs `cyl`.

```{r}
ggplot(data = mpg) +
  geom_point(aes(x = cyl, y = hwy))
```

>  What happens if you make a scatterplot of `class` vs `drv`? Why is
>  the plot not useful?

```{r}
ggplot(data = mpg) +
  geom_point(aes(x = class, y = drv))
```

Because the points are overplotted, it doesn't provide any information on the
number of cars with each combination.

```{r}
table(mpg$class, mpg$drv)
```

## Aesthetic mappings

p. 12

> What's gone wrong with this code? Why are the points not blue?

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, color = "blue"))
```

Defining `color` inside of `aes()` maps the color variable to the character
vector `c("blue")`. Since it only has one unique value, there is only one entry
in the legend. Furthermore it is defined the first default color (more on this
below).

To turn all the points uniformly to blue, define `color` outside of `aes()`.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```

The default colors are determined by running `scale_color_hue()`:

```{r}
scales::show_col(scale_color_hue()$palette(1))
```

```{r}
p <- ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, color = "blue"))
unique(ggplot_build(p)$data[[1]]$colour)
```

https://stackoverflow.com/a/8197706
https://stackoverflow.com/a/25211125

> Which variables in `mpg` are categorical? Which variables are continuous? 
    (Hint: type `?mpg` to read the documentation for the dataset). How
    can you see this information when you run `mpg`?

```{r}
str(mpg)
```

> Map a continuous variable to `color`, `size`, and `shape`. How do
    these aesthetics behave differently for categorical vs. continuous
    variables? 

```{r}
p <- ggplot(data = mpg, mapping = aes(x = displ, y = hwy))
p + geom_point(aes(color = class))
p + geom_point(aes(color = cty))
p + geom_point(aes(size = class))
p + geom_point(aes(size = cty))
p + geom_point(aes(shape = class))
tools::assertError(print(p + geom_point(aes(shape = cty))), verbose = TRUE)
```

Note: Have to use `print()` to catch error because the error is generated by
`print.ggplot()`.

https://stackoverflow.com/a/11782043

> What happens if you map the same variable to multiple aesthetics? 

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class, size = class))
```

Both aesthetics are applied.

> What does the `stroke` aesthetic do? What shapes does it work with?
    (Hint: use `?geom_point`)

```{r}
?geom_point
```

`stroke` controls the width of the border (for shapes that have a border).

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy),
             shape = 21, fill = "white", color = "red", stroke = 3)
```

> What happens if you map an aesthetic to something other than a variable 
    name, like `aes(colour = displ < 5)`?  Note, you'll also need to specify x and y.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, colour = displ < 5))
```

This is analogous to the `color = "blue"` question above. Since a logical vector
has two unique values, `TRUE` and `FALSE`, the points are colored using the
first two default colors. Note that since the x-axis is also `displ`, the color
is providing redundant information in this plot.

## Facets

p. 15

> What happens if you facet on a continuous variable?

It creates a separate facet for each unique value of the continuous variable:

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_wrap(~ cty)
```

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_wrap(~ displ)
```

> What do the empty cells in plot with `facet_grid(drv ~ cyl)` mean?
    How do they relate to this plot?
    
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = drv, y = cyl))
```

The data set does not include any cars with rear wheel drive and 4 or 5
cylinders.

> What plots does the following code make? What does `.` do?

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
```

The `.` is a place holder for the rows or columns.

> Take the first faceted plot in this section:

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```

>    What are the advantages to using faceting instead of the colour aesthetic?
>    What are the disadvantages? How might the balance change if you had a 
>    larger dataset?

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```

The facets make it easier to see the full shape of the distribution for each
class. The disadvantage is that it makes it more difficult to directly compare
across each class. With more cars, there would be an increased possibility of
overplotting, makeing the faceting more advantageous.

> Read `?facet_wrap`. What does `nrow` do? What does `ncol` do? What other
    options control the layout of the individual panels? Why doesn't
    `facet_grid()` have `nrow` and `ncol` arguments?

```{r}
?facet_wrap
```

`nrow` controls the number of rows and `ncol` controls the number of columns.
`as.table` determines the order of the facets. `drop` removes empty facets.
`dir` controls horizontal or vertical ordering.

The number of rows and columns for `facet_grid()` are determined by the number
of unique levels in the variables used for facetting.

> When using `facet_grid()` you should usually put the variable with more
    unique levels in the columns. Why?

I don't feel that this is an obvious question. This
[answer](https://github.com/maxconway/r4ds_solutions/blob/master/visualize_soutions.Rmd#L90)
states it is because screens tend to be wider than longer.
But that makes a lot of assumptions.
First, what if the variable has so many unique levels that it doesn't fit well
horizontally at a readable size on a smaller laptop screen. I personally find it easier to scroll vertically rather than horizontally.
Also, I feel like this should be informed by the importance of the x versus y axis.
Having more columns means it will be easier to compare the y-axis values.
And having more rows means it will be easier to compare the x-axis values.
